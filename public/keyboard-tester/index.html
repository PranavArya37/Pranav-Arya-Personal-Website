<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keyboard Tester & Stuck Key Detector</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #0f172a, #1e1b4b, #1e293b);
            min-height: 100vh;
            font-family: 'Inter', system-ui, sans-serif;
        }

        .key {
            transition: all 0.15s ease;
            position: relative;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .key.active {
            background: linear-gradient(135deg, #6366f1, #8b5cf6) !important;
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.6);
            transform: translateY(-2px);
        }

        .key.tested {
            border: 3px solid #10b981 !important;
        }

        .key.stuck {
            background: linear-gradient(135deg, #ef4444, #dc2626) !important;
            animation: pulse-red 1s infinite;
        }

        @keyframes pulse-red {

            0%,
            100% {
                box-shadow: 0 0 20px rgba(239, 68, 68, 0.6);
            }

            50% {
                box-shadow: 0 0 30px rgba(239, 68, 68, 0.8);
            }
        }

        .faq-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .faq-content.open {
            max-height: 500px;
        }

        .card {
            background: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.1);
        }
    </style>
</head>

<body class="p-4 md:p-8">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-8 md:mb-12">
            <h1 class="text-4xl md:text-6xl font-bold text-white mb-3"
                style="background: linear-gradient(to right, #a78bfa, #60a5fa, #34d399); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                Keyboard Tester
            </h1>
            <p class="text-gray-400 text-sm md:text-lg">Stuck Key Detector & Diagnostic Tool</p>
        </div>

        <!-- Alert Banner -->
        <div id="stuckAlert" class="hidden mb-6 card rounded-xl p-4 border-2 border-red-500">
            <div class="flex items-center">
                <svg class="w-6 h-6 text-red-500 mr-3 flex-shrink-0" fill="none" stroke="currentColor"
                    viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z">
                    </path>
                </svg>
                <div class="flex-1 min-w-0">
                    <p class="text-red-400 font-semibold text-base">⚠️ Stuck Key Detected!</p>
                    <p id="stuckKeysList" class="text-red-300 text-sm mt-1 break-words"></p>
                </div>
            </div>
        </div>

        <!-- Statistics Card -->
        <div class="card rounded-xl p-6 mb-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-white font-bold text-xl">Statistics</h3>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-5 gap-4 text-center">
                <div class="card rounded-lg p-4">
                    <p class="text-gray-400 text-xs uppercase mb-2 font-semibold tracking-wide">Keys Pressed</p>
                    <p id="pressedCount" class="text-3xl font-bold text-indigo-400">0</p>
                </div>
                <div class="card rounded-lg p-4">
                    <p class="text-gray-400 text-xs uppercase mb-2 font-semibold tracking-wide">Tested Keys</p>
                    <p id="testedCount" class="text-3xl font-bold text-green-400">0</p>
                </div>
                <div class="card rounded-lg p-4">
                    <p class="text-gray-400 text-xs uppercase mb-2 font-semibold tracking-wide">Active Keys</p>
                    <p id="activeCount" class="text-3xl font-bold text-purple-400">0</p>
                </div>
                <div class="card rounded-lg p-4">
                    <p class="text-gray-400 text-xs uppercase mb-2 font-semibold tracking-wide">Stuck Keys</p>
                    <p id="stuckCount" class="text-3xl font-bold text-red-400">0</p>
                </div>
                <div class="col-span-2 md:col-span-1 card rounded-lg p-4">
                    <p class="text-gray-400 text-xs uppercase mb-2 font-semibold tracking-wide">Status</p>
                    <p id="status" class="text-3xl font-bold text-green-400">Ready</p>
                </div>
            </div>
        </div>

        <!-- Keyboard Controls -->
        <div class="flex justify-between items-center mb-6">
            <div class="card rounded-lg p-1.5 inline-flex gap-1">
                <button id="windowsBtn"
                    class="px-6 py-2.5 rounded-md bg-indigo-600 text-white text-sm font-semibold transition-all hover:bg-indigo-700">
                    Windows
                </button>
                <button id="macBtn"
                    class="px-6 py-2.5 rounded-md text-gray-300 text-sm font-semibold transition-all hover:bg-slate-700">
                    Mac
                </button>
            </div>

            <button id="resetBtn"
                class="card rounded-lg px-5 py-2.5 bg-red-600 hover:bg-red-700 text-white text-sm font-semibold transition-all flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                    </path>
                </svg>
                Reset
            </button>
        </div>

        <!-- Keyboard Container -->
        <div class="card rounded-xl p-6 mb-6 overflow-x-auto">
            <div id="keyboardContainer" class="min-w-max mx-auto" style="width: fit-content;"></div>
        </div>

        <!-- Event Log -->
        <div class="card rounded-xl p-6 mb-6">
            <h2 class="text-white font-bold text-xl mb-4 flex items-center">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                    </path>
                </svg>
                Event Log <span class="text-gray-500 text-sm ml-2">(Last 10 Keys)</span>
            </h2>
            <div id="eventLog" class="space-y-2 max-h-64 overflow-y-auto">
                <p class="text-gray-500 text-sm">Waiting for keyboard input...</p>
            </div>
        </div>

        <!-- FAQ Section -->
        <div class="card rounded-xl p-6 md:p-8 mb-24">
            <h2 class="text-3xl md:text-4xl font-bold text-white text-center mb-2">Frequently Asked Questions</h2>
            <p class="text-gray-400 text-center text-sm mb-8">Have questions? We have answers.</p>

            <div class="space-y-3 max-w-4xl mx-auto">
                <div class="card rounded-lg overflow-hidden">
                    <button onclick="toggleFAQ(0)"
                        class="w-full flex justify-between items-center p-5 hover:bg-slate-700/30 transition-all">
                        <span class="text-white font-medium text-left">How does the stuck key detection work?</span>
                        <svg class="w-5 h-5 text-gray-400 transform transition-transform faq-icon-0" fill="none"
                            stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7">
                            </path>
                        </svg>
                    </button>
                    <div class="faq-content faq-content-0">
                        <div class="px-5 mt-3 pb-4 text-gray-300 text-sm leading-relaxed">
                            The app uses three detection methods:
                            <ol class="list-decimal list-inside mt-2 space-y-1">
                                <li>detecting repeated keydown events without keyup</li>
                                <li>checking modifier states on page load using getModifierState()</li>
                                <li>continuous monitoring via mouse movement</li>
                            </ol>
                            When a key is stuck, it will turn red and pulse, alerting you immediately.
                        </div>
                    </div>
                </div>

                <div class="card rounded-lg overflow-hidden">
                    <button onclick="toggleFAQ(1)"
                        class="w-full flex justify-between items-center p-5 hover:bg-slate-700/30 transition-all">
                        <span class="text-white font-medium text-left">What's the difference between tested keys and
                            active keys?</span>
                        <svg class="w-5 h-5 text-gray-400 transform transition-transform faq-icon-1" fill="none"
                            stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7">
                            </path>
                        </svg>
                    </button>
                    <div class="faq-content faq-content-1">
                        <div class="px-5 mt-3 pb-4 text-gray-300 text-sm leading-relaxed">
                            "Tested keys" shows how many keys you've pressed at least once (marked with a green border).
                            "Active keys" shows keys currently being held down. Tested keys help you track which keys
                            you've verified are working properly.
                        </div>
                    </div>
                </div>

                <div class="card rounded-lg overflow-hidden">
                    <button onclick="toggleFAQ(2)"
                        class="w-full flex justify-between items-center p-5 hover:bg-slate-700/30 transition-all">
                        <span class="text-white font-medium text-left">Why should I use Windows vs Mac keyboard
                            layout?</span>
                        <svg class="w-5 h-5 text-gray-400 transform transition-transform faq-icon-2" fill="none"
                            stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7">
                            </path>
                        </svg>
                    </button>
                    <div class="faq-content faq-content-2">
                        <div class="px-5 mt-3 pb-4 text-gray-300 text-sm leading-relaxed">
                            Choose the layout that matches your physical keyboard. Windows keyboards have a "Windows"
                            key (⊞) and "Ctrl" key, while Mac keyboards have "Command" (⌘) and "Option" keys. Using the
                            matching layout helps you visually identify keys more easily.
                        </div>
                    </div>
                </div>

                <div class="card rounded-lg overflow-hidden">
                    <button onclick="toggleFAQ(3)"
                        class="w-full flex justify-between items-center p-5 hover:bg-slate-700/30 transition-all">
                        <span class="text-white font-medium text-left">Is my keyboard data stored or sent
                            anywhere?</span>
                        <svg class="w-5 h-5 text-gray-400 transform transition-transform faq-icon-3" fill="none"
                            stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7">
                            </path>
                        </svg>
                    </button>
                    <div class="faq-content faq-content-3">
                        <div class="px-5 mt-3 pb-4 text-gray-300 text-sm leading-relaxed">
                            No. Everything runs locally in your browser. No data is stored, collected, or transmitted to
                            any server. Your keyboard testing is completely private and secure. You can even use this
                            app offline after the initial load.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <!-- <footer class="py-6 text-center border-t border-gray-700/30"> -->
        <footer class="pt-8 pb-0 text-center border-t border-gray-700/30">
            <p class="text-gray-400 text-sm">
                © 2026 Keyboard Tester - Made with ❤️ in India by <a href="https://pranavarya.in" target="_blank"
                    rel="noopener noreferrer"
                    class="text-purple-400 hover:text-purple-300 transition-colors font-medium">Pranav Arya</a>. All
                rights reserved.
            </p>
        </footer>
    </div>

    <script>
        const state = {
            pressedKeys: new Map(),
            stuckKeys: new Set(),
            testedKeys: new Set(),
            eventHistory: [],
            totalPresses: 0,
            currentLayout: 'windows'
        };

        const elements = {
            pressedCount: document.getElementById('pressedCount'),
            testedCount: document.getElementById('testedCount'),
            activeCount: document.getElementById('activeCount'),
            stuckCount: document.getElementById('stuckCount'),
            status: document.getElementById('status'),
            eventLog: document.getElementById('eventLog'),
            stuckAlert: document.getElementById('stuckAlert'),
            stuckKeysList: document.getElementById('stuckKeysList'),
            windowsBtn: document.getElementById('windowsBtn'),
            macBtn: document.getElementById('macBtn'),
            keyboardContainer: document.getElementById('keyboardContainer'),
            resetBtn: document.getElementById('resetBtn')
        };

        elements.resetBtn.addEventListener('click', () => {
            state.pressedKeys.clear();
            state.stuckKeys.clear();
            state.testedKeys.clear();
            state.eventHistory = [];
            state.totalPresses = 0;

            document.querySelectorAll('.key').forEach(key => {
                key.classList.remove('active', 'stuck', 'tested');
            });

            updateUI();
            elements.eventLog.innerHTML = '<p class="text-gray-500 text-sm">Waiting for keyboard input...</p>';

            setTimeout(() => {
                addToLog('✓ System reset complete. All progress cleared.', 'normal');
            }, 100);
        });

        function createKey(code, label, width = '42px') {
            return `<div data-key="${code}" class="key bg-gray-200 hover:bg-gray-100 rounded px-2 py-2 text-gray-800 text-xs font-semibold cursor-pointer border border-gray-300 text-center" style="min-width: ${width};">${label}</div>`;
        }

        function renderWindowsKeyboard() {
            return `
                <div class="flex gap-1 mb-2">
                    ${createKey('Escape', 'Esc', '42px')}
                    <div class="w-12"></div>
                    ${createKey('F1', 'F1', '38px')}
                    ${createKey('F2', 'F2', '38px')}
                    ${createKey('F3', 'F3', '38px')}
                    ${createKey('F4', 'F4', '38px')}
                    <div class="w-6"></div>
                    ${createKey('F5', 'F5', '38px')}
                    ${createKey('F6', 'F6', '38px')}
                    ${createKey('F7', 'F7', '38px')}
                    ${createKey('F8', 'F8', '38px')}
                    <div class="w-6"></div>
                    ${createKey('F9', 'F9', '38px')}
                    ${createKey('F10', 'F10', '38px')}
                    ${createKey('F11', 'F11', '38px')}
                    ${createKey('F12', 'F12', '38px')}
                </div>
                <div class="h-3"></div>
                <div class="flex gap-1 mb-1">
                    ${createKey('Backquote', '`')}
                    ${createKey('Digit1', '1')}
                    ${createKey('Digit2', '2')}
                    ${createKey('Digit3', '3')}
                    ${createKey('Digit4', '4')}
                    ${createKey('Digit5', '5')}
                    ${createKey('Digit6', '6')}
                    ${createKey('Digit7', '7')}
                    ${createKey('Digit8', '8')}
                    ${createKey('Digit9', '9')}
                    ${createKey('Digit0', '0')}
                    ${createKey('Minus', '-')}
                    ${createKey('Equal', '=')}
                    ${createKey('Backspace', '←', '70px')}
                </div>
                <div class="flex gap-1 mb-1">
                    ${createKey('Tab', '→ Tab', '56px')}
                    ${createKey('KeyQ', 'Q')}
                    ${createKey('KeyW', 'W')}
                    ${createKey('KeyE', 'E')}
                    ${createKey('KeyR', 'R')}
                    ${createKey('KeyT', 'T')}
                    ${createKey('KeyY', 'Y')}
                    ${createKey('KeyU', 'U')}
                    ${createKey('KeyI', 'I')}
                    ${createKey('KeyO', 'O')}
                    ${createKey('KeyP', 'P')}
                    ${createKey('BracketLeft', '[')}
                    ${createKey('BracketRight', ']')}
                    ${createKey('Backslash', '\\', '56px')}
                </div>
                <div class="flex gap-1 mb-1">
                    ${createKey('CapsLock', 'Caps', '68px')}
                    ${createKey('KeyA', 'A')}
                    ${createKey('KeyS', 'S')}
                    ${createKey('KeyD', 'D')}
                    ${createKey('KeyF', 'F')}
                    ${createKey('KeyG', 'G')}
                    ${createKey('KeyH', 'H')}
                    ${createKey('KeyJ', 'J')}
                    ${createKey('KeyK', 'K')}
                    ${createKey('KeyL', 'L')}
                    ${createKey('Semicolon', ';')}
                    ${createKey('Quote', "'")}
                    ${createKey('Enter', 'Enter', '84px')}
                </div>
                <div class="flex gap-1 mb-1">
                    ${createKey('ShiftLeft', 'Shift', '96px')}
                    ${createKey('KeyZ', 'Z')}
                    ${createKey('KeyX', 'X')}
                    ${createKey('KeyC', 'C')}
                    ${createKey('KeyV', 'V')}
                    ${createKey('KeyB', 'B')}
                    ${createKey('KeyN', 'N')}
                    ${createKey('KeyM', 'M')}
                    ${createKey('Comma', ',')}
                    ${createKey('Period', '.')}
                    ${createKey('Slash', '/')}
                    ${createKey('ShiftRight', 'Shift', '96px')}
                </div>
                <div class="flex gap-1 mb-2">
                    ${createKey('ControlLeft', 'Ctrl', '54px')}
                    ${createKey('MetaLeft', '⊞', '54px')}
                    ${createKey('AltLeft', 'Alt', '54px')}
                    ${createKey('Space', '', '260px')}
                    ${createKey('AltRight', 'Alt', '54px')}
                    ${createKey('MetaRight', '⊞', '54px')}
                    ${createKey('ContextMenu', '☰', '54px')}
                    ${createKey('ControlRight', 'Ctrl', '54px')}
                </div>
                <div class="flex justify-end gap-1 mt-2">
                    <div class="grid grid-cols-3 gap-1">
                        <div></div>
                        ${createKey('ArrowUp', '↑')}
                        <div></div>
                        ${createKey('ArrowLeft', '←')}
                        ${createKey('ArrowDown', '↓')}
                        ${createKey('ArrowRight', '→')}
                    </div>
                </div>
            `;
        }

        function renderMacKeyboard() {
            return `
                <div class="flex gap-1 mb-2">
                    ${createKey('Escape', 'esc', '42px')}
                    <div class="w-12"></div>
                    ${createKey('F1', 'F1', '38px')}
                    ${createKey('F2', 'F2', '38px')}
                    ${createKey('F3', 'F3', '38px')}
                    ${createKey('F4', 'F4', '38px')}
                    <div class="w-6"></div>
                    ${createKey('F5', 'F5', '38px')}
                    ${createKey('F6', 'F6', '38px')}
                    ${createKey('F7', 'F7', '38px')}
                    ${createKey('F8', 'F8', '38px')}
                    <div class="w-6"></div>
                    ${createKey('F9', 'F9', '38px')}
                    ${createKey('F10', 'F10', '38px')}
                    ${createKey('F11', 'F11', '38px')}
                    ${createKey('F12', 'F12', '38px')}
                </div>
                <div class="h-3"></div>
                <div class="flex gap-1 mb-1">
                    ${createKey('Backquote', '`')}
                    ${createKey('Digit1', '1')}
                    ${createKey('Digit2', '2')}
                    ${createKey('Digit3', '3')}
                    ${createKey('Digit4', '4')}
                    ${createKey('Digit5', '5')}
                    ${createKey('Digit6', '6')}
                    ${createKey('Digit7', '7')}
                    ${createKey('Digit8', '8')}
                    ${createKey('Digit9', '9')}
                    ${createKey('Digit0', '0')}
                    ${createKey('Minus', '-')}
                    ${createKey('Equal', '=')}
                    ${createKey('Backspace', 'delete', '70px')}
                </div>
                <div class="flex gap-1 mb-1">
                    ${createKey('Tab', 'tab', '56px')}
                    ${createKey('KeyQ', 'Q')}
                    ${createKey('KeyW', 'W')}
                    ${createKey('KeyE', 'E')}
                    ${createKey('KeyR', 'R')}
                    ${createKey('KeyT', 'T')}
                    ${createKey('KeyY', 'Y')}
                    ${createKey('KeyU', 'U')}
                    ${createKey('KeyI', 'I')}
                    ${createKey('KeyO', 'O')}
                    ${createKey('KeyP', 'P')}
                    ${createKey('BracketLeft', '[')}
                    ${createKey('BracketRight', ']')}
                    ${createKey('Backslash', '\\', '56px')}
                </div>
                <div class="flex gap-1 mb-1">
                    ${createKey('CapsLock', 'caps lock', '68px')}
                    ${createKey('KeyA', 'A')}
                    ${createKey('KeyS', 'S')}
                    ${createKey('KeyD', 'D')}
                    ${createKey('KeyF', 'F')}
                    ${createKey('KeyG', 'G')}
                    ${createKey('KeyH', 'H')}
                    ${createKey('KeyJ', 'J')}
                    ${createKey('KeyK', 'K')}
                    ${createKey('KeyL', 'L')}
                    ${createKey('Semicolon', ';')}
                    ${createKey('Quote', "'")}
                    ${createKey('Enter', 'return', '84px')}
                </div>
                <div class="flex gap-1 mb-1">
                    ${createKey('ShiftLeft', 'shift', '96px')}
                    ${createKey('KeyZ', 'Z')}
                    ${createKey('KeyX', 'X')}
                    ${createKey('KeyC', 'C')}
                    ${createKey('KeyV', 'V')}
                    ${createKey('KeyB', 'B')}
                    ${createKey('KeyN', 'N')}
                    ${createKey('KeyM', 'M')}
                    ${createKey('Comma', ',')}
                    ${createKey('Period', '.')}
                    ${createKey('Slash', '/')}
                    ${createKey('ShiftRight', 'shift', '96px')}
                </div>
                <div class="flex gap-1 mb-2">
                    ${createKey('ControlLeft', 'control', '62px')}
                    ${createKey('AltLeft', 'option', '62px')}
                    ${createKey('MetaLeft', '⌘', '62px')}
                    ${createKey('Space', '', '230px')}
                    ${createKey('MetaRight', '⌘', '62px')}
                    ${createKey('AltRight', 'option', '62px')}
                    ${createKey('ControlRight', 'control', '62px')}
                </div>
                <div class="flex justify-end gap-1 mt-2">
                    <div class="grid grid-cols-3 gap-1">
                        <div></div>
                        ${createKey('ArrowUp', '↑')}
                        <div></div>
                        ${createKey('ArrowLeft', '←')}
                        ${createKey('ArrowDown', '↓')}
                        ${createKey('ArrowRight', '→')}
                    </div>
                </div>
            `;
        }

        function switchKeyboard(layout) {
            state.currentLayout = layout;
            elements.keyboardContainer.innerHTML = layout === 'windows' ? renderWindowsKeyboard() : renderMacKeyboard();

            if (layout === 'windows') {
                elements.windowsBtn.className = 'px-6 py-2.5 rounded-md bg-indigo-600 text-white text-sm font-semibold transition-all hover:bg-indigo-700';
                elements.macBtn.className = 'px-6 py-2.5 rounded-md text-gray-300 text-sm font-semibold transition-all hover:bg-slate-700';
            } else {
                elements.macBtn.className = 'px-6 py-2.5 rounded-md bg-indigo-600 text-white text-sm font-semibold transition-all hover:bg-indigo-700';
                elements.windowsBtn.className = 'px-6 py-2.5 rounded-md text-gray-300 text-sm font-semibold transition-all hover:bg-slate-700';
            }

            state.testedKeys.forEach(code => {
                const keyEl = document.querySelector(`[data-key="${code}"]`);
                if (keyEl) keyEl.classList.add('tested');
            });

            state.stuckKeys.forEach(code => {
                const keyEl = document.querySelector(`[data-key="${code}"]`);
                if (keyEl) keyEl.classList.add('stuck');
            });

            state.pressedKeys.forEach((timestamp, code) => {
                const keyEl = document.querySelector(`[data-key="${code}"]`);
                if (keyEl && !state.stuckKeys.has(code)) {
                    keyEl.classList.add('active');
                }
            });
        }

        elements.windowsBtn.addEventListener('click', () => switchKeyboard('windows'));
        elements.macBtn.addEventListener('click', () => switchKeyboard('mac'));

        function toggleFAQ(index) {
            const content = document.querySelector(`.faq-content-${index}`);
            const icon = document.querySelector(`.faq-icon-${index}`);
            content.classList.toggle('open');
            icon.classList.toggle('rotate-180');
        }

        function checkInitialModifierState() {
            const modifiers = ['Control', 'Alt', 'Shift', 'Meta'];
            const event = new KeyboardEvent('keydown');

            modifiers.forEach(mod => {
                if (event.getModifierState(mod)) {
                    [`${mod}Left`, `${mod}Right`].forEach(key => {
                        if (!state.stuckKeys.has(key)) {
                            state.stuckKeys.add(key);
                            const keyEl = document.querySelector(`[data-key="${key}"]`);
                            if (keyEl) keyEl.classList.add('stuck');
                        }
                    });
                    addToLog(`⚠️ ${mod} was already pressed on page load!`, 'stuck');
                }
            });

            if (state.stuckKeys.size > 0) updateUI();
        }

        function handleKeyDown(e) {
            const code = e.code;
            if (e.ctrlKey || e.metaKey || e.altKey) e.preventDefault();

            if (state.pressedKeys.has(code)) {
                if (!state.stuckKeys.has(code)) {
                    state.stuckKeys.add(code);
                    updateKeyVisual(code, 'stuck');
                    addToLog(`⚠️ STUCK: ${e.key} (${code})`, 'stuck');
                    updateUI();
                }
                return;
            }

            state.pressedKeys.set(code, Date.now());
            state.totalPresses++;

            if (!state.testedKeys.has(code)) {
                state.testedKeys.add(code);
                const keyEl = document.querySelector(`[data-key="${code}"]`);
                if (keyEl) keyEl.classList.add('tested');
            }

            updateKeyVisual(code, 'active');
            addToLog(`Key: ${e.key} | Code: ${code}`, 'normal');
            updateUI();
        }

        function handleKeyUp(e) {
            const code = e.code;
            state.pressedKeys.delete(code);

            if (state.stuckKeys.has(code)) {
                state.stuckKeys.delete(code);
                addToLog(`✓ Released: ${e.key} (${code})`, 'normal');
            }

            updateKeyVisual(code, 'inactive');
            updateUI();
        }

        function updateKeyVisual(code, stateType) {
            const keyEl = document.querySelector(`[data-key="${code}"]`);
            if (!keyEl) return;

            keyEl.classList.remove('active', 'stuck');

            if (stateType === 'active') {
                keyEl.classList.add('active');
            } else if (stateType === 'stuck') {
                keyEl.classList.add('stuck');
            }
        }

        function addToLog(message, type = 'normal') {
            state.eventHistory.unshift({ message, type, timestamp: new Date().toLocaleTimeString() });
            if (state.eventHistory.length > 10) state.eventHistory.pop();
            renderLog();
        }

        function renderLog() {
            if (state.eventHistory.length === 0) {
                elements.eventLog.innerHTML = '<p class="text-gray-500 text-sm">Waiting for keyboard input...</p>';
                return;
            }

            elements.eventLog.innerHTML = state.eventHistory.map(entry => {
                const color = entry.type === 'stuck' ? 'text-red-400' : 'text-gray-300';
                return `
                    <div class="flex justify-between items-center p-3 bg-slate-800/30 rounded-lg border border-slate-700/50">
                        <span class="${color} text-sm font-mono break-all">${entry.message}</span>
                        <span class="text-gray-500 text-xs ml-2 flex-shrink-0">${entry.timestamp}</span>
                    </div>
                `;
            }).join('');
        }

        function updateUI() {
            elements.pressedCount.textContent = state.totalPresses;
            elements.testedCount.textContent = state.testedKeys.size;
            elements.activeCount.textContent = state.pressedKeys.size;
            elements.stuckCount.textContent = state.stuckKeys.size;

            if (state.stuckKeys.size > 0) {
                elements.status.textContent = 'Alert!';
                elements.status.className = 'text-3xl font-bold text-red-400';
                elements.stuckAlert.classList.remove('hidden');
                elements.stuckKeysList.textContent = `Stuck keys: ${Array.from(state.stuckKeys).join(', ')}`;
            } else if (state.pressedKeys.size > 0) {
                elements.status.textContent = 'Active';
                elements.status.className = 'text-3xl font-bold text-yellow-400';
                elements.stuckAlert.classList.add('hidden');
            } else {
                elements.status.textContent = 'Ready';
                elements.status.className = 'text-3xl font-bold text-green-400';
                elements.stuckAlert.classList.add('hidden');
            }
        }

        function checkModifierState(e) {
            const modifiers = [
                { name: 'Control', left: 'ControlLeft', right: 'ControlRight' },
                { name: 'Alt', left: 'AltLeft', right: 'AltRight' },
                { name: 'Shift', left: 'ShiftLeft', right: 'ShiftRight' },
                { name: 'Meta', left: 'MetaLeft', right: 'MetaRight' }
            ];

            modifiers.forEach(mod => {
                const isPressed = e.getModifierState(mod.name);
                const leftPressed = state.pressedKeys.has(mod.left);
                const rightPressed = state.pressedKeys.has(mod.right);

                if (isPressed && !leftPressed && !rightPressed) {
                    [mod.left, mod.right].forEach(key => {
                        if (!state.stuckKeys.has(key)) {
                            state.stuckKeys.add(key);
                            const keyEl = document.querySelector(`[data-key="${key}"]`);
                            if (keyEl) keyEl.classList.add('stuck');
                            addToLog(`⚠️ ${mod.name} detected as stuck via modifier check`, 'stuck');
                        }
                    });
                    updateUI();
                }
            });
        }

        document.addEventListener('keydown', handleKeyDown);
        document.addEventListener('keyup', handleKeyUp);
        document.addEventListener('mousemove', checkModifierState);
        document.addEventListener('contextmenu', e => e.preventDefault());

        window.addEventListener('load', () => {
            switchKeyboard('windows');
            checkInitialModifierState();
            addToLog('System ready. Start typing to test your keyboard.', 'normal');
        });

        window.addEventListener('blur', () => {
            state.pressedKeys.forEach((_, code) => updateKeyVisual(code, 'inactive'));
            state.pressedKeys.clear();
            updateUI();
        });
    </script>
</body>

</html>