<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keyboard Tester - Pranav Arya</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="Test your keyboard for stuck keys and malfunctioning keys. A diagnostic tool to help identify keyboard issues.">
    <meta name="author" content="Pranav Arya">
    <meta name="keywords" content="keyboard tester, stuck key detector, keyboard diagnostic, key testing tool, Pranav Arya">

    <!-- Open Graph -->
    <meta property="og:title" content="Keyboard Tester - Pranav Arya">
    <meta property="og:description" content="Test your keyboard for stuck keys and malfunctioning keys. A diagnostic tool to help identify keyboard issues.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://pranavarya.in/keyboard-tester/">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #0a0a0a;
            min-height: 100vh;
            font-family: 'Inter', system-ui, sans-serif;
        }

        .key {
            transition: all 0.15s ease;
            position: relative;
            overflow: hidden;
        }

        .key::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(1, 95, 252, 0.1), rgba(1, 95, 252, 0.05));
            opacity: 0;
            transition: opacity 0.15s ease;
        }

        .key:hover::before {
            opacity: 1;
        }

        .key.active {
            background: linear-gradient(135deg, #015FFC, #0147d1) !important;
            box-shadow: 0 0 20px rgba(1, 95, 252, 0.6), 0 0 40px rgba(1, 95, 252, 0.4);
            transform: translateY(-2px);
        }

        .key.stuck {
            background: linear-gradient(135deg, #ef4444, #dc2626) !important;
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.6), 0 0 40px rgba(220, 38, 38, 0.4);
            animation: pulse-red 1s infinite;
        }

        @keyframes pulse-red {
            0%, 100% { box-shadow: 0 0 20px rgba(239, 68, 68, 0.6), 0 0 40px rgba(220, 38, 38, 0.4); }
            50% { box-shadow: 0 0 30px rgba(239, 68, 68, 0.8), 0 0 60px rgba(220, 38, 38, 0.6); }
        }

        .log-entry {
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .glow-text {
            text-shadow: 0 0 10px rgba(1, 95, 252, 0.3);
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-7xl mx-auto">
        <!-- Back to Home Button -->
        <div class="mb-6">
            <a href="/" class="inline-flex items-center text-gray-400 hover:text-white transition-colors duration-300">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                </svg>
                Back to Home
            </a>
        </div>

        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-white mb-2 glow-text">Keyboard Tester</h1>
            <p class="text-gray-400 text-sm md:text-base">Stuck Key Detector & Diagnostic Tool</p>
        </div>

        <!-- Alert Banner for Stuck Keys -->
        <div id="stuckAlert" class="hidden mb-6 bg-red-900/30 border-2 border-red-500 rounded-lg p-4">
            <div class="flex items-center">
                <svg class="w-6 h-6 text-red-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                </svg>
                <div>
                    <p class="text-red-400 font-semibold">⚠️ Stuck Key Detected!</p>
                    <p id="stuckKeysList" class="text-red-300 text-sm mt-1"></p>
                </div>
            </div>
        </div>

        <!-- Status Bar -->
        <div class="bg-gray-900/50 backdrop-blur-sm rounded-lg p-4 mb-6 border border-gray-700">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                <div>
                    <p class="text-gray-400 text-xs uppercase">Keys Pressed</p>
                    <p id="pressedCount" class="text-2xl font-bold" style="color: #015FFC;">0</p>
                </div>
                <div>
                    <p class="text-gray-400 text-xs uppercase">Active Keys</p>
                    <p id="activeCount" class="text-2xl font-bold" style="color: #0147d1;">0</p>
                </div>
                <div>
                    <p class="text-gray-400 text-xs uppercase">Stuck Keys</p>
                    <p id="stuckCount" class="text-2xl font-bold text-red-400">0</p>
                </div>
                <div>
                    <p class="text-gray-400 text-xs uppercase">Status</p>
                    <p id="status" class="text-2xl font-bold text-green-400">Ready</p>
                </div>
            </div>
        </div>

        <!-- Keyboard Layout -->
        <div class="bg-gray-900/50 backdrop-blur-sm rounded-lg p-4 md:p-6 mb-6 border border-gray-700">
            <!-- Row 1: Number Row -->
            <div class="flex gap-1 mb-1 justify-center">
                <div data-key="Escape" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-14">Esc</div>
                <div class="w-8"></div>
                <div data-key="F1" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">F1</div>
                <div data-key="F2" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">F2</div>
                <div data-key="F3" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">F3</div>
                <div data-key="F4" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">F4</div>
                <div class="w-4"></div>
                <div data-key="F5" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">F5</div>
                <div data-key="F6" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">F6</div>
                <div data-key="F7" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">F7</div>
                <div data-key="F8" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">F8</div>
                <div class="w-4"></div>
                <div data-key="F9" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">F9</div>
                <div data-key="F10" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">F10</div>
                <div data-key="F11" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">F11</div>
                <div data-key="F12" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">F12</div>
            </div>

            <!-- Row 2: Numbers -->
            <div class="flex gap-1 mb-1 justify-center">
                <div data-key="Backquote" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">`</div>
                <div data-key="Digit1" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">1</div>
                <div data-key="Digit2" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">2</div>
                <div data-key="Digit3" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">3</div>
                <div data-key="Digit4" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">4</div>
                <div data-key="Digit5" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">5</div>
                <div data-key="Digit6" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">6</div>
                <div data-key="Digit7" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">7</div>
                <div data-key="Digit8" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">8</div>
                <div data-key="Digit9" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">9</div>
                <div data-key="Digit0" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">0</div>
                <div data-key="Minus" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">-</div>
                <div data-key="Equal" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">=</div>
                <div data-key="Backspace" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-20">Back</div>
            </div>

            <!-- Row 3: QWERTY -->
            <div class="flex gap-1 mb-1 justify-center">
                <div data-key="Tab" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-16">Tab</div>
                <div data-key="KeyQ" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">Q</div>
                <div data-key="KeyW" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">W</div>
                <div data-key="KeyE" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">E</div>
                <div data-key="KeyR" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">R</div>
                <div data-key="KeyT" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">T</div>
                <div data-key="KeyY" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">Y</div>
                <div data-key="KeyU" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">U</div>
                <div data-key="KeyI" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">I</div>
                <div data-key="KeyO" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">O</div>
                <div data-key="KeyP" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">P</div>
                <div data-key="BracketLeft" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">[</div>
                <div data-key="BracketRight" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">]</div>
                <div data-key="Backslash" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-16">\</div>
            </div>

            <!-- Row 4: ASDF -->
            <div class="flex gap-1 mb-1 justify-center">
                <div data-key="CapsLock" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-20">Caps</div>
                <div data-key="KeyA" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">A</div>
                <div data-key="KeyS" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">S</div>
                <div data-key="KeyD" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">D</div>
                <div data-key="KeyF" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">F</div>
                <div data-key="KeyG" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">G</div>
                <div data-key="KeyH" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">H</div>
                <div data-key="KeyJ" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">J</div>
                <div data-key="KeyK" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">K</div>
                <div data-key="KeyL" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">L</div>
                <div data-key="Semicolon" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">;</div>
                <div data-key="Quote" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">'</div>
                <div data-key="Enter" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-24">Enter</div>
            </div>

            <!-- Row 5: ZXCV -->
            <div class="flex gap-1 mb-1 justify-center">
                <div data-key="ShiftLeft" class="key rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border w-24" style="background-color: #1a3a6b; border-color: #015FFC;">Shift</div>
                <div data-key="KeyZ" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">Z</div>
                <div data-key="KeyX" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">X</div>
                <div data-key="KeyC" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">C</div>
                <div data-key="KeyV" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">V</div>
                <div data-key="KeyB" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">B</div>
                <div data-key="KeyN" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">N</div>
                <div data-key="KeyM" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">M</div>
                <div data-key="Comma" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">,</div>
                <div data-key="Period" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">.</div>
                <div data-key="Slash" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 w-12">/</div>
                <div data-key="ShiftRight" class="key rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border w-24" style="background-color: #1a3a6b; border-color: #015FFC;">Shift</div>
            </div>

            <!-- Row 6: Bottom Row -->
            <div class="flex gap-1 justify-center">
                <div data-key="ControlLeft" class="key rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border w-16" style="background-color: #1a3a6b; border-color: #015FFC;">Ctrl</div>
                <div data-key="MetaLeft" class="key rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border w-16" style="background-color: #1a3a6b; border-color: #015FFC;">Win</div>
                <div data-key="AltLeft" class="key rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border w-16" style="background-color: #1a3a6b; border-color: #015FFC;">Alt</div>
                <div data-key="Space" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 flex-1">Space</div>
                <div data-key="AltRight" class="key rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border w-16" style="background-color: #1a3a6b; border-color: #015FFC;">Alt</div>
                <div data-key="MetaRight" class="key rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border w-16" style="background-color: #1a3a6b; border-color: #015FFC;">Win</div>
                <div data-key="ControlRight" class="key rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border w-16" style="background-color: #1a3a6b; border-color: #015FFC;">Ctrl</div>
            </div>

            <!-- Arrow Keys -->
            <div class="mt-4 flex justify-center">
                <div class="grid grid-cols-3 gap-1 w-40">
                    <div></div>
                    <div data-key="ArrowUp" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 text-center">↑</div>
                    <div></div>
                    <div data-key="ArrowLeft" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 text-center">←</div>
                    <div data-key="ArrowDown" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 text-center">↓</div>
                    <div data-key="ArrowRight" class="key bg-gray-800 hover:bg-gray-700 rounded px-3 py-2 text-white text-xs font-mono cursor-pointer border border-gray-600 text-center">→</div>
                </div>
            </div>
        </div>

        <!-- Event Log -->
        <div class="bg-gray-900/50 backdrop-blur-sm rounded-lg p-4 border border-gray-700">
            <h2 class="text-white font-semibold mb-3 flex items-center">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                Event Log (Last 10 Keys)
            </h2>
            <div id="eventLog" class="space-y-2 max-h-48 overflow-y-auto">
                <p class="text-gray-500 text-sm">Waiting for keyboard input...</p>
            </div>
        </div>
    </div>

    <script>
        // State management
        const state = {
            pressedKeys: new Map(), // Map of code -> timestamp
            stuckKeys: new Set(),
            eventHistory: [],
            totalPresses: 0
        };

        // DOM elements
        const elements = {
            pressedCount: document.getElementById('pressedCount'),
            activeCount: document.getElementById('activeCount'),
            stuckCount: document.getElementById('stuckCount'),
            status: document.getElementById('status'),
            eventLog: document.getElementById('eventLog'),
            stuckAlert: document.getElementById('stuckAlert'),
            stuckKeysList: document.getElementById('stuckKeysList')
        };

        // Initialize: Check for pre-pressed modifier keys
        function checkInitialModifierState() {
            const modifiers = ['Control', 'Alt', 'Shift', 'Meta'];
            const event = new KeyboardEvent('keydown');
            
            modifiers.forEach(mod => {
                if (event.getModifierState(mod)) {
                    // Highlight the stuck modifier key
                    const leftKey = document.querySelector(`[data-key="${mod}Left"]`);
                    const rightKey = document.querySelector(`[data-key="${mod}Right"]`);
                    
                    if (leftKey) {
                        leftKey.classList.add('stuck');
                        state.stuckKeys.add(`${mod}Left`);
                    }
                    if (rightKey) {
                        rightKey.classList.add('stuck');
                        state.stuckKeys.add(`${mod}Right`);
                    }
                    
                    addToLog(`⚠️ ${mod} was already pressed on load!`, 'stuck');
                }
            });
            
            updateUI();
        }

        // Key down handler
        function handleKeyDown(e) {
            const code = e.code;
            
            // Prevent default for common shortcuts
            if (e.ctrlKey || e.metaKey || e.altKey) {
                e.preventDefault();
            }

            // Check if this is a repeated keydown without keyup (stuck key detection)
            if (state.pressedKeys.has(code)) {
                // Key is already pressed - mark as stuck
                if (!state.stuckKeys.has(code)) {
                    state.stuckKeys.add(code);
                    addToLog(`⚠️ STUCK: ${e.key} (${code})`, 'stuck');
                    updateKeyVisual(code, 'stuck');
                }
                return;
            }

            // Record the key press
            state.pressedKeys.set(code, Date.now());
            state.totalPresses++;
            
            // Update visual
            updateKeyVisual(code, 'active');
            
            // Add to log
            addToLog(`Key: ${e.key} | Code: ${code}`, 'normal');
            
            updateUI();
        }

        // Key up handler
        function handleKeyUp(e) {
            const code = e.code;
            
            // Remove from pressed keys
            state.pressedKeys.delete(code);
            
            // Remove from stuck keys if it was stuck
            if (state.stuckKeys.has(code)) {
                state.stuckKeys.delete(code);
            }
            
            // Update visual
            updateKeyVisual(code, 'inactive');
            
            updateUI();
        }

        // Update key visual state
        function updateKeyVisual(code, state) {
            const keyElement = document.querySelector(`[data-key="${code}"]`);
            if (!keyElement) return;
            
            keyElement.classList.remove('active', 'stuck');
            
            if (state === 'active') {
                keyElement.classList.add('active');
            } else if (state === 'stuck') {
                keyElement.classList.add('stuck');
            }
        }

        // Add entry to event log
        function addToLog(message, type = 'normal') {
            const entry = { message, type, timestamp: new Date().toLocaleTimeString() };
            state.eventHistory.unshift(entry);
            
            // Keep only last 10 entries
            if (state.eventHistory.length > 10) {
                state.eventHistory.pop();
            }
            
            renderLog();
        }

        // Render the event log
        function renderLog() {
            if (state.eventHistory.length === 0) {
                elements.eventLog.innerHTML = '<p class="text-gray-500 text-sm">Waiting for keyboard input...</p>';
                return;
            }
            
            elements.eventLog.innerHTML = state.eventHistory.map(entry => {
                const color = entry.type === 'stuck' ? 'text-red-400' : 'text-gray-300';
                return `
                    <div class="log-entry flex justify-between items-center p-2 bg-gray-800/50 rounded border border-gray-700">
                        <span class="${color} text-sm font-mono">${entry.message}</span>
                        <span class="text-gray-500 text-xs">${entry.timestamp}</span>
                    </div>
                `;
            }).join('');
        }

        // Update UI counters and status
        function updateUI() {
            elements.pressedCount.textContent = state.totalPresses;
            elements.activeCount.textContent = state.pressedKeys.size;
            elements.stuckCount.textContent = state.stuckKeys.size;
            
            // Update status
            if (state.stuckKeys.size > 0) {
                elements.status.textContent = 'Alert!';
                elements.status.className = 'text-2xl font-bold text-red-400';
                
                // Show alert banner
                elements.stuckAlert.classList.remove('hidden');
                elements.stuckKeysList.textContent = `Stuck keys: ${Array.from(state.stuckKeys).join(', ')}`;
            } else if (state.pressedKeys.size > 0) {
                elements.status.textContent = 'Active';
                elements.status.className = 'text-2xl font-bold text-yellow-400';
                elements.stuckAlert.classList.add('hidden');
            } else {
                elements.status.textContent = 'Ready';
                elements.status.className = 'text-2xl font-bold text-green-400';
                elements.stuckAlert.classList.add('hidden');
            }
        }

        // Check modifier state on mouse movement
        function checkModifierState(e) {
            const modifiers = [
                { name: 'Control', left: 'ControlLeft', right: 'ControlRight' },
                { name: 'Alt', left: 'AltLeft', right: 'AltRight' },
                { name: 'Shift', left: 'ShiftLeft', right: 'ShiftRight' },
                { name: 'Meta', left: 'MetaLeft', right: 'MetaRight' }
            ];
            
            modifiers.forEach(mod => {
                const isPressed = e.getModifierState(mod.name);
                const leftPressed = state.pressedKeys.has(mod.left);
                const rightPressed = state.pressedKeys.has(mod.right);
                
                // If modifier is active but we don't have it in our state, it might be stuck
                if (isPressed && !leftPressed && !rightPressed) {
                    // Mark as potentially stuck
                    [mod.left, mod.right].forEach(key => {
                        const keyElement = document.querySelector(`[data-key="${key}"]`);
                        if (keyElement && !state.stuckKeys.has(key)) {
                            state.stuckKeys.add(key);
                            keyElement.classList.add('stuck');
                            addToLog(`⚠️ ${mod.name} detected as stuck via mouse movement`, 'stuck');
                        }
                    });
                    updateUI();
                }
            });
        }

        // Event listeners
        document.addEventListener('keydown', handleKeyDown);
        document.addEventListener('keyup', handleKeyUp);
        document.addEventListener('mousemove', checkModifierState);

        // Prevent context menu on right-click to allow testing
        document.addEventListener('contextmenu', e => e.preventDefault());

        // Initialize on load
        window.addEventListener('load', () => {
            checkInitialModifierState();
            addToLog('System ready. Start typing to test your keyboard.', 'normal');
        });

        // Handle window blur (user switches tabs/windows)
        window.addEventListener('blur', () => {
            // Clear all active keys when window loses focus
            state.pressedKeys.forEach((_, code) => {
                updateKeyVisual(code, 'inactive');
            });
            state.pressedKeys.clear();
            updateUI();
        });
    </script>
</body>
</html>